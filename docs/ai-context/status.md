# 프로젝트 상태 (Status)

## 현재 진행 상황
- **기능 구현 완료**: Google Drive 스타일의 파일 탐색 GUI 구현.
    - 백엔드 API 고도화 (파일 크기, 수정일 정보 추가).
    - 프론트엔드 `FolderContent`를 `Table` 기반으로 전면 개편.
    - Breadcrumb 내비게이션 및 폴더 진입/탐색 기능 추가.
- **버그 수정**: 트리 중복 생성 및 확장 불능 문제 해결 상태 유지 확인.
- **Space 연동 완료** (2026-02-04):
    - **통합 트리 구조**: Space 목록과 FolderTree를 하나의 트리로 완전 통합.
    - Spaces가 트리의 루트 노드로 표시, 확장 시 해당 Space의 하위 디렉토리 로드.
    - Space 메뉴 제거, 단일 트리 구조로 단순화.
    - `FolderTree`가 `spaces` prop을 받아 Space 노드 생성 및 lazy loading 처리.
    - `MainSider`: Spaces 헤더 + 버튼, 통합 FolderTree.
    - `FileExplorer` 단순화: FolderContent만 전체 화면으로 표시.
    - 모달에서는 `showBaseDirectories` 플래그로 시스템 디렉토리 탐색.
    - 파일: `MainLayout/index.tsx`, `MainSider.tsx`, `FileExplorer.tsx`, `FolderTree.tsx` 수정.
- **코드 품질 개선** (2026-02-04):
    - Serena MCP 필수 사용 규칙을 `CLAUDE.md`에 추가.
    - 여러 Serena replace_symbol_body 사용 시 발생한 중복 코드 제거.
    - ESLint 에러 수정: 파싱 에러, 사용하지 않는 import, any 타입 등.
    - React 권장 패턴 준수: useEffect에서 setState 제거, 올바른 폼 초기화.
    - 테마 대응: 텍스트 색상이 다크/라이트 모드에 맞춰 자동 변경.

- **문서 구조 개편** (2026-02-04):
    - `CLAUDE.md`를 `.claude/CLAUDE.md`로 이동 (Claude Code CLI 전용 설정).
    - `GEMINI.md` 간소화: "docs/master_rule.md를 먼저 읽기"로 단순화.
    - `docs/master_rule.md`에 모든 규칙 통합:
        - Playwright MCP 브라우저 테스트 절차 추가.
        - 디자인 규칙 (8px 그리드, 일관된 radius 등) 명시.
        - 커밋 메시지 규칙 (한글, 간결체) 추가.
        - Serena MCP 사용 상세 규칙을 GEMINI.md에서 이동.
    - `.gitignore`에 테스트/디버깅 디렉토리 추가 (.playwright-mcp/, .serena 등).

- **문서 구조 개선** (2026-02-04):
    - `docs/AGENTS.md` 생성: 실행 환경 정보 통합 문서.
        - 프로젝트 구조, 서버 실행, 빌드, 포트 정보.
        - 테스트 방법, 트러블슈팅, 패키지 관리.
    - `.claude/CLAUDE.md`, `GEMINI.md` 수정: AGENTS.md 읽기 추가.
- **Space 상대 경로 Breadcrumb 구현 완료** (2026-02-04):
    - FolderTree: Space 선택 시 Space 정보도 함께 전달하도록 수정.
    - MainLayout: selectedSpace state 추가 및 Outlet context에 포함.
    - FileExplorer: OutletContext에 selectedSpace 추가.
    - FolderContent: Space 상대 경로로 Breadcrumb 표시.
        - Space 선택 시: "SpaceName / folder1 / folder2" 형식.
        - Space 미선택 시: 기존 절대 경로 유지.
    - 타입 에러 수정 (FolderContent, DirectorySetupModal).
    - Playwright 브라우저 테스트 완료: Breadcrumb 정상 작동 확인.

- **Space 삭제 기능 구현 완료** (2026-02-04):
    - FolderTree: Space 노드에 Context Menu (Dropdown) 추가.
    - MainSider: useDeleteSpace 훅 사용하여 삭제 로직 구현.
    - 삭제 확인 Modal (Modal.confirm) 추가.
    - 삭제 후 Space 목록 자동 갱신.
    - 성공/실패 메시지 표시 (message.success/error).
    - Playwright 브라우저 테스트 완료: Context Menu, 확인 모달, 삭제 후 트리 갱신 모두 정상 작동 확인.

- **파일 표시 버그 수정 완료** (2026-02-04):
    - 문제: FolderContent에서 폴더만 표시되고 파일이 표시되지 않음.
    - 원인: `browse_handler.go`의 `ListDirectory` 호출 시 `isOnlyDir` 파라미터가 `true`로 설정되어 있어 파일 필터링.
    - 해결: `apps/backend/internal/browse/handler/browse_handler.go:51` 라인 수정.
        - 변경 전: `h.browseService.ListDirectory(true, targetPath)`
        - 변경 후: `h.browseService.ListDirectory(false, targetPath)`
    - 결과: 오른쪽 FolderContent에서 폴더와 파일이 모두 정상 표시.
    - Playwright 브라우저 테스트 완료: 파일 아이콘, 크기, 수정일 모두 정상 표시 확인.

- **파일 다운로드 기능 구현 완료** (2026-02-04):
    - 백엔드: `/api/browse/download` 엔드포인트 추가.
        - 파일 경로를 쿼리 파라미터로 받아 파일 다운로드 제공.
        - Content-Disposition 헤더로 파일명 설정.
        - 디렉토리 다운로드 방지, 권한 및 존재 여부 검증.
    - 프론트엔드: FolderContent에서 파일 클릭 시 다운로드.
        - 폴더: 클릭 시 해당 폴더로 이동 (기존 동작 유지).
        - 파일: `<a href="/api/browse/download?path=..." download>` 링크로 다운로드.
    - 수정 파일:
        - `apps/backend/internal/browse/handler/browse_handler.go` (handleDownload 추가)
        - `apps/frontend/src/features/browse/components/FolderContent.tsx` (파일 링크 수정)
    - Playwright 브라우저 테스트 완료: README.md 다운로드 정상 작동 확인.

- **Space 경로 보안 강화 완료** (2026-02-04):
    - 문제: Space로 할당되지 않은 시스템 경로에도 접근 가능한 보안 취약점.
    - 해결: Space 경로 검증 기능 추가.
    - 백엔드:
        - `browse_handler.go`에 `isPathAllowed` 함수 추가.
        - 요청 경로가 등록된 Space의 하위 경로인지 검증.
        - Space가 없을 때는 모든 경로 허용 (하위 호환성).
        - `system=true` 쿼리 파라미터로 시스템 탐색 모드 지원 (Space 생성용).
        - browse/download API에서 경로 검증 수행.
    - 프론트엔드:
        - `useBrowseApi.ts`: `fetchDirectoryContents`에 `systemMode` 파라미터 추가.
        - `FolderTree.tsx`: Space 생성 모달(`showBaseDirectories`)에서 `systemMode=true` 전달.
    - 수정 파일:
        - `apps/backend/internal/browse/handler/browse_handler.go`
        - `apps/backend/main.go` (spaceService 주입)
        - `apps/frontend/src/features/browse/hooks/useBrowseApi.ts`
        - `apps/frontend/src/features/browse/components/FolderTree.tsx`
    - 결과:
        - 일반 탐색: Space 경로만 접근 가능, 403 에러로 차단.
        - Space 생성: 시스템 전체 탐색 가능 (충돌 없음).
    - Playwright 브라우저 테스트 완료: Space 탐색 정상, 시스템 탐색 정상.

- **파일/폴더 컨텍스트 메뉴 구현 완료** (2026-02-05):
    - 상위 폴더 버튼 삭제: Breadcrumb만으로 탐색하도록 UI 단순화.
    - 파일/폴더 우클릭 컨텍스트 메뉴 추가:
        - 파일: "다운로드", "이름 변경", "삭제" 메뉴.
        - 폴더: "이름 변경", "삭제" 메뉴 (다운로드 제외).
    - 구현:
        - `FolderContent.tsx`: 컨텍스트 메뉴 상태 관리 및 렌더링.
        - Table의 `onRow` 이벤트에 `onContextMenu` 추가.
        - Menu 컴포넌트로 컨텍스트 메뉴 표시.
        - 파일 타입에 따라 메뉴 항목 조건부 표시.
    - TODO: 이름 변경, 삭제 기능 백엔드 API 및 실제 동작 구현.
    - Playwright 브라우저 테스트 완료: 상위 폴더 버튼 제거 확인, 파일/폴더별 컨텍스트 메뉴 정상 작동.

- **파일/폴더 이름 변경 및 삭제 기능 구현 완료** (2026-02-05):
    - 파일 이름 클릭 시 다운로드 제거: 우클릭 메뉴로만 다운로드 가능.
    - 백엔드 API 추가:
        - `/api/browse/rename`: 파일/폴더 이름 변경 (POST).
        - `/api/browse/delete`: 파일/폴더 삭제 (POST).
        - Space 경로 검증: 요청 경로와 새 경로 모두 허용된 Space 내부인지 확인.
        - 폴더 삭제: `os.RemoveAll`로 하위 파일 포함 전체 삭제.
    - 프론트엔드 구현:
        - 이름 변경 모달: 현재 이름이 입력 필드에 표시, Enter 키로 확인.
        - 삭제 확인 모달: `Modal.confirm`으로 확인 후 삭제.
        - API 호출 후 성공/실패 메시지 표시 (`message.success/error`).
        - 작업 완료 후 디렉토리 목록 자동 새로고침.
    - 수정 파일:
        - `apps/backend/internal/browse/handler/browse_handler.go`
        - `apps/frontend/src/features/browse/components/FolderContent.tsx`
    - Playwright 브라우저 테스트 완료:
        - 파일 이름 클릭 시 다운로드 안 됨 확인.
        - 이름 변경 모달 및 실제 변경 작동 확인.
        - 삭제 확인 모달 및 실제 삭제 작동 확인.
        - 목록 자동 새로고침 확인.

- **파일 업로드 기능 구현 완료** (2026-02-05):
    - 백엔드 API 추가:
        - `POST /api/browse/upload`: multipart/form-data로 파일 업로드.
        - 요청: `file` (파일), `targetPath` (업로드 대상 디렉토리), `overwrite` (선택, 덮어쓰기 여부).
        - Space 경로 검증: 업로드 대상 경로가 Space 내부인지 확인.
        - 파일 중복 확인: 동일 이름 파일 존재 시 409 Conflict 에러 (overwrite=false).
        - 덮어쓰기 지원: `overwrite=true`일 때 기존 파일 덮어쓰기.
        - 최대 업로드 크기: 32MB.
    - 프론트엔드 구현:
        - Ant Design `Upload.Dragger` 컴포넌트 사용.
        - Drag & Drop 또는 클릭으로 파일 선택.
        - `customRequest`로 커스텀 업로드 로직 구현.
        - 409 에러 발생 시 `Modal.confirm`으로 덮어쓰기 확인.
        - 덮어쓰기 확인 시 `overwrite=true`로 재업로드.
        - 업로드 성공 시 메시지 표시 및 목록 자동 새로고침.
        - FolderContent 상단에 업로드 영역 배치.
    - 수정 파일:
        - `apps/backend/internal/browse/handler/browse_handler.go` (handleUpload 추가)
        - `apps/frontend/src/features/browse/components/FolderContent.tsx` (Upload.Dragger 추가)
    - Chrome Extension 브라우저 테스트 완료:
        - Drag & Drop 영역 정상 표시.
        - 파일 업로드 API 정상 작동 (test-upload.txt 업로드 성공).
        - 업로드된 파일이 목록에 즉시 표시됨.
        - 중복 파일 업로드 시 덮어쓰기 확인 모달 정상 작동.
        - 덮어쓰기 기능 정상 작동 (duplicate-test.txt 테스트 완료).

- **뷰 전환 기능 구현 완료** (2026-02-05):
    - 테이블 뷰와 그리드 뷰를 전환할 수 있는 기능 추가.
    - 구현 내용:
        - 뷰 모드 state 추가 ('table' | 'grid').
        - Breadcrumb 우측에 뷰 전환 버튼 추가.
        - 버튼 아이콘: UnorderedListOutlined (테이블), AppstoreOutlined (그리드).
        - 활성 버튼은 primary 타입으로 강조.
    - 그리드 뷰 구현:
        - Ant Design Row/Col과 Card 컴포넌트 사용.
        - 반응형 그리드: xs=12, sm=8, md=6, lg=4, xl=3 (화면 크기별 열 수 조정).
        - 카드 내용: 큰 아이콘 (48px), 파일 이름, 파일 크기 (파일만).
        - 폴더 더블 클릭 시 이동 기능 유지.
        - 우클릭 컨텍스트 메뉴 기능 유지.
    - 수정 파일:
        - `apps/frontend/src/features/browse/components/FolderContent.tsx` (뷰 전환 버튼, 그리드 뷰 추가)
    - Chrome Extension 브라우저 테스트 완료:
        - 뷰 전환 버튼 정상 표시.
        - 테이블 ↔ 그리드 양방향 전환 정상 작동.
        - 그리드 뷰에서 파일/폴더 정상 표시.
        - 그리드 뷰에서 폴더 더블 클릭 이동 정상 작동.

- **업로드 UI 개선 완료** (2026-02-05):
    - Upload.Dragger 섹션 제거, 화면 공간 효율화.
    - 전체 영역 드래그 앤 드롭 지원:
        - 파일 드래그 시 반투명 파란색 오버레이 표시.
        - "파일을 놓아 업로드" 메시지 및 아이콘 표시.
        - 드롭 시 파일 업로드 시작.
    - 업로드 버튼 추가:
        - 위치: Breadcrumb 우측, 뷰 전환 버튼 옆.
        - UploadOutlined 아이콘 + "업로드" 텍스트.
        - 클릭 시 파일 선택 대화상자 열림.
    - 숨겨진 file input으로 파일 선택 처리.
    - 드래그/버튼 모두 동일한 업로드 로직 사용 (중복 확인 포함).
    - 수정 파일:
        - `apps/frontend/src/features/browse/components/FolderContent.tsx` (드래그 이벤트, 업로드 버튼 추가)

- **Breadcrumb 절대 경로 버그 수정 완료** (2026-02-06):
    - 문제: 하위 폴더(2+ depth) 이동 시 breadcrumb이 절대 경로로 표시됨.
    - 원인:
        - FolderTree에서 Space 노드가 아닌 하위 폴더 선택 시 Space 정보 없이 경로만 전달.
        - FolderContent에서 폴더 더블 클릭 시 `onPathChange(path)` 호출로 `selectedSpace` 미업데이트.
        - `selectedSpace`가 현재 경로와 동기화되지 않아 breadcrumb 로직 실패.
    - 해결:
        - `MainLayout/index.tsx`의 `handlePathSelect` 함수 수정.
        - Space가 명시적으로 전달되지 않으면 현재 경로에서 해당하는 Space 자동 탐색.
        - `spaces.find(s => path.startsWith(s.space_path))`로 매칭되는 Space 찾기.
        - 찾은 Space를 `selectedSpace`에 설정하여 breadcrumb이 항상 올바른 상대 경로 표시.
    - 수정 파일:
        - `apps/frontend/src/components/layout/MainLayout/index.tsx` (handlePathSelect 로직 개선)
    - Chrome Extension 브라우저 테스트 완료:
        - Space 선택 후 하위 폴더로 이동 시 상대 경로 정상 표시 ("헬로 / Test Folder").
        - 2+ depth 폴더 이동 시에도 상대 경로 정상 표시 ("헬로 / Test Folder / Contents / Frameworks").

- **폴더 ZIP 다운로드 기능 구현 완료** (2026-02-06):
    - 백엔드: `handleDownload()` 함수 수정하여 폴더/파일 자동 구분 처리.
    - 백엔드: `downloadFolderAsZip()` 함수 추가로 폴더 압축 다운로드 지원.
        - Go 표준 라이브러리 `archive/zip` 사용 (외부 의존성 없음).
        - HTTP response에 직접 스트리밍 (메모리 효율적).
        - `filepath.Walk()`로 재귀적 폴더 탐색.
        - 심볼릭 링크 자동 스킵 (보안).
        - 압축 파일명: `{folderName}.zip`.
    - 프론트엔드: 컨텍스트 메뉴에 폴더 다운로드 옵션 추가.
        - 파일: "다운로드" 메뉴 표시.
        - 폴더: "폴더 다운로드 (ZIP)" 메뉴 표시.
    - 수정 파일:
        - `apps/backend/internal/browse/handler/browse_handler.go` (import 추가, handleDownload 수정, downloadFolderAsZip 추가)
        - `apps/frontend/src/features/browse/components/FolderContent.tsx` (컨텍스트 메뉴 조건 수정)
    - Chrome Extension 브라우저 테스트 완료:
        - 폴더 우클릭 시 "폴더 다운로드 (ZIP)" 메뉴 정상 표시.
        - 파일 우클릭 시 "다운로드" 메뉴 정상 표시.
        - Test Folder.zip 다운로드 성공.
        - zip 파일 내부에 모든 하위 폴더/파일 구조 정상 포함.

- **그리드 뷰 기본값 변경 완료** (2026-02-06):
    - 파일 탐색기의 기본 뷰를 테이블에서 그리드로 변경.
    - `FolderContent.tsx`의 `viewMode` 초기값을 'table'에서 'grid'로 수정.
    - 수정 파일:
        - `apps/frontend/src/features/browse/components/FolderContent.tsx` (viewMode 기본값 변경)
    - Chrome Extension 브라우저 테스트 완료:
        - Space 선택 시 그리드 뷰가 기본으로 표시.
        - 파일/폴더가 카드 형태로 정상 표시.
        - 뷰 전환 버튼에서 그리드 버튼이 활성화 상태.

- **레이아웃 여백 통일 완료** (2026-02-07):
    - 모든 영역의 수평 패딩을 8-grid 기준 16px로 일괄 통일.
    - Header: antd 기본값(0 50px) → 명시적 `0 16px`.
    - 사이드바 헤더: `12px 16px` → `16px` (12px 8-grid 위반 수정).
    - 사이드바 트리: `8px` → `8px 16px` (수평 패딩 통일).
    - 메인 콘텐츠: `24px` → `16px` (수평 패딩 통일).
    - 수정 파일: `MainLayout/index.tsx`, `MainSider.tsx`, `FileExplorer.tsx`.
    - Chrome Extension 브라우저 테스트 완료: 다크/라이트 모드, 그리드/테이블 뷰 모두 확인.

- **서버 상태 표시 개선** (2026-02-07):
    - Status popover 위치를 텍스트 바로 아래로 변경 (`bottomLeft`).
    - 접근 가능한 호스트 주소 목록 표시 (`net.InterfaceAddrs()`).
    - 각 프로토콜의 포트 및 경로 표시 (HTTP: `:3000/api/`, WebDAV: `:3000/dav/`).
    - 백엔드: `ProtocolStatus`에 `Port`, `Path` 필드 추가, `StatusResponse`에 `Hosts` 필드 추가.
    - 프론트엔드: `ServerStatus.tsx` popover에 호스트, 포트, 경로 정보 표시.

- **WebDAV 루트 디렉토리 가상 Space 목록 노출** (2026-02-07):
    - `/dav/` 접근 시 400 에러 → 모든 Space를 가상 폴더로 표시하도록 수정.
    - `SpaceFS` 커스텀 `webdav.FileSystem` 구현 (`spacefs.go`).
    - 루트(`/`) PROPFIND 시 Space 목록을 가상 디렉토리로 반환.
    - `/{spaceName}/...` 경로는 실제 OS 파일시스템으로 위임.
    - `service.go`에 `GetRootHandler()` 추가, `webdav_handler.go`에서 루트 요청 위임.
    - curl PROPFIND 테스트 완료: 모든 Space가 폴더로 정상 표시.

## 다음 작업 (Next Steps)
- 이미지/텍스트 파일 미리보기 기능 검토.
- 파일 복사/이동 기능 검토.